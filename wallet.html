<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø­ÙØ¸ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        background: #0d0d0d;
        color: white;
        font-family: system-ui;
        margin: 0;
        padding: 15px;
        text-align: center;
    }

    h2 {
        color: gold;
        margin-bottom: 20px;
        font-size: 22px;
    }

    .box {
        background: #1d1d1d;
        padding: 20px;
        border-radius: 15px;
        border: 1px solid #444;
        margin-bottom: 20px;
    }

    .balance {
        font-size: 28px;
        color: gold;
        font-weight: bold;
        margin-bottom: 10px;
    }

    button {
        width: 100%;
        padding: 12px;
        margin-top: 15px;
        background: gold;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        color: black;
        cursor: pointer;
    }

    .note {
        color: #bbb;
        font-size: 13px;
        margin-top: 10px;
    }
</style>
</head>

<body>

<h2>Ù…Ø­ÙØ¸ØªÙŠ</h2>

<div class="box">

    <div class="balance" id="balance">0.00$</div>
    <div class="note">Ø±ØµÙŠØ¯Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>

    <button onclick="goDeposit()">Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</button>
    <button onclick="withdrawCheck()">Ø³Ø­Ø¨ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</button>
    <button onclick="goInvest()">Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</button>

    <div class="note">
        âš  Ø§Ù„Ø³Ø­Ø¨ Ù…Ø³Ù…ÙˆØ­ ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ù…Ø±ÙˆØ± <b>25 ÙŠÙˆÙ…</b> Ù…Ù† Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ø´Ø­Ù†
    </div>

</div>

<script type="module">

import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
    "https://zrnrrnbyhjcusfwoeucd.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
);

let user_id = null;
let firstDepositDate = null;

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
async function loadWallet() {

    let { data: session } = await supabase.auth.getUser();

    if (!session.user) {
        window.location.href = "index.html";
        return;
    }

    user_id = session.user.id;

    // Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let { data: bal } = await supabase
        .from("balances")
        .select("*")
        .eq("user_id", user_id)
        .maybeSingle();

    document.getElementById("balance").textContent = (bal?.balance ?? 0) + "$";

    firstDepositDate = bal?.first_deposit_date ?? null;
}

loadWallet();

// Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø´Ø­Ù†
function goDeposit() {
    window.location.href = "deposit.html";
}

// Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±
function goInvest() {
    window.location.href = "investment.html";
}

// ÙØ­Øµ Ø´Ø±Ø· 25 ÙŠÙˆÙ…
function withdrawCheck() {

    if (!firstDepositDate) {
        alert("ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø³Ø­Ø¨ Ù‚Ø¨Ù„ ØªÙ†ÙÙŠØ° Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ø´Ø­Ù†");
        return;
    }

    let start = new Date(firstDepositDate);
    let now = new Date();

    let diff = (now - start) / (1000 * 60 * 60 * 24);

    if (diff < 25) {
        alert("ğŸš« Ø§Ù„Ø³Ø­Ø¨ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù‚Ø¨Ù„ Ù…Ø±ÙˆØ± 25 ÙŠÙˆÙ…\nØ¨Ø§Ù‚ÙŠ: " + Math.ceil(25 - diff) + " ÙŠÙˆÙ…");
        return;
    }

    window.location.href = "withdraw.html";
}

</script>

</body>
</html>
